<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Tobias Pietzsch">
<meta name="dcterms.date" content="2022-08-08">
<meta name="description" content="How to set up user-configurable keyboard shortcuts using ui-behaviour and BigDataViewer’s Preferences Dialog">

<title>ImgLib2 news and tutorials - User-configurable Keymaps</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="ImgLib2 news and tutorials - User-configurable Keymaps">
<meta property="og:description" content="How to set up user-configurable keyboard shortcuts using ui-behaviour and BigDataViewer’s Preferences Dialog">
<meta property="og:image" content="https://imglib.github.io/imglib2-blog/posts/2022-08-08-keymaps/keymap-prefs.png">
<meta property="og:site_name" content="ImgLib2 news and tutorials">
<meta property="og:image:height" content="685">
<meta property="og:image:width" content="779">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../imglib2-logo-header.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ImgLib2 news and tutorials</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">ImgLib2</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/imglib"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@imglib2"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">User-configurable Keymaps</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button" data-quarto-source-url="https://github.com/imglib/imglib2-blog/blob/main/posts/2022-08-08-keymaps/2022-08-08-keymaps.ipynb">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          How to set up user-configurable keyboard shortcuts using <code>ui-behaviour</code> and BigDataViewer’s Preferences Dialog
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">ui-behaviour</div>
                <div class="quarto-category">bigdataviewer</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Tobias Pietzsch </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">August 8, 2022</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#setting-up-shortcuts-through-ui-behaviour" id="toc-setting-up-shortcuts-through-ui-behaviour" class="nav-link" data-scroll-target="#setting-up-shortcuts-through-ui-behaviour">Setting up shortcuts through <code>ui-behaviour</code></a></li>
  <li><a href="#making-shortcuts-configurable" id="toc-making-shortcuts-configurable" class="nav-link" data-scroll-target="#making-shortcuts-configurable">Making shortcuts configurable</a>
  <ul class="collapse">
  <li><a href="#loading-shortcuts-from-a-config-file" id="toc-loading-shortcuts-from-a-config-file" class="nav-link" data-scroll-target="#loading-shortcuts-from-a-config-file">Loading shortcuts from a config file</a></li>
  <li><a href="#action-context" id="toc-action-context" class="nav-link" data-scroll-target="#action-context">Action context</a></li>
  <li><a href="#disabled-actions" id="toc-disabled-actions" class="nav-link" data-scroll-target="#disabled-actions">Disabled actions</a></li>
  </ul></li>
  <li><a href="#configuring-shortcuts-through-the-ui" id="toc-configuring-shortcuts-through-the-ui" class="nav-link" data-scroll-target="#configuring-shortcuts-through-the-ui">Configuring shortcuts through the UI</a>
  <ul class="collapse">
  <li><a href="#preferences-dialog" id="toc-preferences-dialog" class="nav-link" data-scroll-target="#preferences-dialog">Preferences dialog</a></li>
  <li><a href="#commanddescriptions" id="toc-commanddescriptions" class="nav-link" data-scroll-target="#commanddescriptions">CommandDescriptions</a></li>
  </ul></li>
  <li><a href="#making-action-descriptions-discoverable" id="toc-making-action-descriptions-discoverable" class="nav-link" data-scroll-target="#making-action-descriptions-discoverable">Making action descriptions discoverable</a></li>
  <li><a href="#recommended-pattern-for-defining-actions" id="toc-recommended-pattern-for-defining-actions" class="nav-link" data-scroll-target="#recommended-pattern-for-defining-actions">Recommended pattern for defining actions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>While developing the BDV Preferences dialog, a “pattern” has emerged of how we wire up the shortcut and action definitions. This tutorial explains the current recommended way of doing that. We give some background about using <code>ui-behaviour</code> etc. Feel free to just <a href="#Recommended-pattern-for-defining-actions">skip to the end</a> for the recommended pattern.</p>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In <a href="https://forum.image.sc/t/new-bigdataviewer-version-10-4-1/68818">BigDataViewer 10.4</a> we added a Preferences dialog. This makes settings more user accessible, that previously could only be made through editing config files. In particular, users can now easily override BigDataViewer keybindings to their liking.</p>
<p>It is also possible to define and switch between multiple sets of keybindings. For example, in Mastodon, we have predefined keymaps that have * basic BDV key bindings, but many shortcuts remapped to navigate along a cell lineage, or * full BDV key bindings, at the expense of more complicated shortcuts for cell lineage navigation.</p>
<p>On top of these users can define their own completely customised keymaps.</p>
<p>This is all based on <code>ui-bahaviour</code>, which several tools (BDV-based and otherwise) already use for managing shortcuts. While developing the Mastodon Preferences dialog, and now carrying over to BigDataViewer, a pattern has emerged of how we wire up the shortcut and action definitions. It would be great if this would become a blueprint for actions in other tools, because a) that will make the code easier to understand and b) facilitate reuse of action definitions across projects.</p>
<p>We work towards the recommended pattern, from scratch, in a series of examples that you can also find <a href="https://github.com/tpietzsch/keyconfig-examples">on github</a>.</p>
<div id="5ba18cd6" class="cell" data-execution_count="1">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="op">%%</span>loadFromPOM</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>repository<span class="op">&gt;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>id<span class="op">&gt;</span>scijava<span class="op">.</span><span class="fu">public</span><span class="op">&lt;/</span>id<span class="op">&gt;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>url<span class="op">&gt;</span>https<span class="op">:</span><span class="co">//maven.scijava.org/content/groups/public&lt;/url&gt;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>repository<span class="op">&gt;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>dependency<span class="op">&gt;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>groupId<span class="op">&gt;</span>sc<span class="op">.</span><span class="fu">fiji</span><span class="op">&lt;/</span>groupId<span class="op">&gt;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>artifactId<span class="op">&gt;</span>bigdataviewer<span class="op">-</span>core<span class="op">&lt;/</span>artifactId<span class="op">&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>version<span class="op">&gt;</span><span class="fl">10.4.3</span><span class="op">&lt;/</span>version<span class="op">&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>dependency<span class="op">&gt;</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>dependency<span class="op">&gt;</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>groupId<span class="op">&gt;</span>org<span class="op">.</span><span class="fu">scijava</span><span class="op">&lt;/</span>groupId<span class="op">&gt;</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>artifactId<span class="op">&gt;</span>ui<span class="op">-</span>behaviour<span class="op">&lt;/</span>artifactId<span class="op">&gt;</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">&lt;</span>version<span class="op">&gt;</span><span class="fl">2.0.7</span><span class="op">&lt;/</span>version<span class="op">&gt;</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;/</span>dependency<span class="op">&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="setting-up-shortcuts-through-ui-behaviour" class="level2">
<h2 class="anchored" data-anchor-id="setting-up-shortcuts-through-ui-behaviour">Setting up shortcuts through <code>ui-behaviour</code></h2>
<p>Lets look at a basic example of integrating <code>ui-beahviour</code> in a AWT/Swing application.</p>
<p>We need a minimal application to play with: <code>MainPanel</code> is a <code>JPanel</code> containing (only) a single <code>JLabel</code> displaying the text <code>"hello"</code>. The displayed text can be changed by the <code>setText(String)</code> method. We will use this to define different mock “actions”.</p>
<div id="6ebcaddf" class="cell" data-execution_count="2">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">awt</span><span class="op">.</span><span class="im">BorderLayout</span><span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">awt</span><span class="op">.</span><span class="im">Dimension</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">javax</span><span class="op">.</span><span class="im">swing</span><span class="op">.</span><span class="im">JFrame</span><span class="op">;</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">javax</span><span class="op">.</span><span class="im">swing</span><span class="op">.</span><span class="im">JLabel</span><span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">javax</span><span class="op">.</span><span class="im">swing</span><span class="op">.</span><span class="im">JPanel</span><span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">javax</span><span class="op">.</span><span class="im">swing</span><span class="op">.</span><span class="im">border</span><span class="op">.</span><span class="im">EmptyBorder</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="a4f65731" class="cell" data-execution_count="3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MainPanel <span class="kw">extends</span> <span class="bu">JPanel</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> <span class="bu">JLabel</span> label<span class="op">;</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">MainPanel</span><span class="op">()</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setLayout</span><span class="op">(</span> <span class="kw">new</span> <span class="bu">BorderLayout</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setBorder</span><span class="op">(</span> <span class="kw">new</span> <span class="bu">EmptyBorder</span><span class="op">(</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">20</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setFocusable</span><span class="op">(</span> <span class="kw">true</span> <span class="op">);</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>        label <span class="op">=</span> <span class="kw">new</span> <span class="bu">JLabel</span><span class="op">(</span> <span class="st">"hello"</span> <span class="op">);</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">add</span><span class="op">(</span> label<span class="op">,</span> <span class="bu">BorderLayout</span><span class="op">.</span><span class="fu">CENTER</span> <span class="op">);</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">setText</span><span class="op">(</span> <span class="dt">final</span> <span class="bu">String</span> text <span class="op">)</span></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>        label<span class="op">.</span><span class="fu">setText</span><span class="op">(</span> text <span class="op">);</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s instantiate a <code>MainPanel</code> and show it in a <code>JFrame</code>.</p>
<div id="c5bd7ea4" class="cell" data-execution_count="4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> frame <span class="op">=</span> <span class="kw">new</span> <span class="bu">JFrame</span><span class="op">(</span> <span class="st">"Keymaps Demo"</span> <span class="op">);</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> panel <span class="op">=</span> <span class="kw">new</span> <span class="fu">MainPanel</span><span class="op">();</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>frame<span class="op">.</span><span class="fu">add</span><span class="op">(</span> panel <span class="op">);</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>frame<span class="op">.</span><span class="fu">setPreferredSize</span><span class="op">(</span> <span class="kw">new</span> <span class="bu">Dimension</span><span class="op">(</span> <span class="dv">200</span><span class="op">,</span> <span class="dv">100</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>frame<span class="op">.</span><span class="fu">pack</span><span class="op">();</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>frame<span class="op">.</span><span class="fu">setVisible</span><span class="op">(</span> <span class="kw">true</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="hello.png" class="img-fluid figure-img"></p>
<figcaption>MainPanel showing text “hello”</figcaption>
</figure>
</div>
<div id="6646b82c" class="cell" data-execution_count="5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">javax</span><span class="op">.</span><span class="im">swing</span><span class="op">.</span><span class="im">JComponent</span><span class="op">;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">javax</span><span class="op">.</span><span class="im">swing</span><span class="op">.</span><span class="im">SwingUtilities</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>To set up <code>ui-behaviour</code> for the <code>panel</code>, we first need an instance of <code>InputActionBindings</code></p>
<div id="9bccd7eb" class="cell" data-execution_count="6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">behaviour</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">InputActionBindings</span><span class="op">;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> bindings <span class="op">=</span> <span class="kw">new</span> <span class="fu">InputActionBindings</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>InputActionBindings</code> bind inputs to actions.</p>
<p>This is of course exactly what AWT/Swing’s <a href="https://docs.oracle.com/javase/tutorial/uiswing/misc/keybinding.html">Key Bindings</a> framework (<code>InputMap</code>, <code>ActionMap</code>) does. <code>InputActionBindings</code> adds very little over that; basically only more convenient <code>InputMap</code> chaining.</p>
<p>Side note: The initial purpose of <code>ui-behaviour</code> was to offer a similar framework for mouse clicks, scrolls, drags, etc. Modeled after <code>InputMap</code> and <code>ActionMap</code>, there are <code>InputTriggerMap</code> and <code>BehaviourMap</code>. Analogous to <code>InputActionBindings</code> there is <code>TriggerBehaviourBindings</code>.</p>
<p>Anyway, we connect the <code>InputActionBindings</code> instance to our <code>MainPanel</code> as follows.</p>
<div id="e58745e6" class="cell" data-execution_count="7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">SwingUtilities</span><span class="op">.</span><span class="fu">replaceUIActionMap</span><span class="op">(</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">,</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    bindings<span class="op">.</span><span class="fu">getConcatenatedActionMap</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="bu">SwingUtilities</span><span class="op">.</span><span class="fu">replaceUIInputMap</span><span class="op">(</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    panel<span class="op">,</span> <span class="bu">JComponent</span><span class="op">.</span><span class="fu">WHEN_ANCESTOR_OF_FOCUSED_COMPONENT</span><span class="op">,</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    bindings<span class="op">.</span><span class="fu">getConcatenatedInputMap</span><span class="op">()</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>InputActionBindings</code> manages a chain of <code>InputMap</code>/<code>ActionMap</code> pairs. An <code>Actions</code> object encapsulates one such pair, and feeds new action definitions into it. We create a new <code>Actions</code> (the constructor arguments don’t matter for now) …</p>
<div id="0f6c1a46" class="cell" data-execution_count="8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">behaviour</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">InputTriggerConfig</span><span class="op">;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">behaviour</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Actions</span><span class="op">;</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> actions <span class="op">=</span> <span class="kw">new</span> <span class="fu">Actions</span><span class="op">(</span> <span class="kw">new</span> <span class="fu">InputTriggerConfig</span><span class="op">(),</span> <span class="st">"demo"</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>… and we add the pair to our <code>InputActionBindings</code> under the name “actions”.</p>
<div id="f271f1a6" class="cell" data-execution_count="9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>actions<span class="op">.</span><span class="fu">install</span><span class="op">(</span> bindings<span class="op">,</span> <span class="st">"actions"</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>(We could use the name later to remove, replace, or temporarily block the <code>InputMap</code>/<code>ActionMap</code> pair.)</p>
<p>The <code>actions</code> instance is now connected to the <code>panel</code> via <code>bindings</code>. We can finally use it to add new shortcuts.</p>
<div id="0b7be221" class="cell" data-execution_count="10">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>actions<span class="op">.</span><span class="fu">runnableAction</span><span class="op">(</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">()</span> <span class="op">-&gt;</span> panel<span class="op">.</span><span class="fu">setText</span><span class="op">(</span> <span class="st">"Action A triggered"</span> <span class="op">),</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Action A"</span><span class="op">,</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SPACE"</span><span class="op">,</span> <span class="st">"A"</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>actions.runnableAction</code> method takes the following arguments</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">runnableAction</span><span class="op">(</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">Runnable</span> runnable<span class="op">,</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span> name<span class="op">,</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">String</span><span class="kw">...</span> defaultKeyStrokes <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ol type="1">
<li>A Runnable to run when the action is triggered.</li>
<li>A unique name for the action (this will be used as the actions key in the underlying <code>InputMap</code>/<code>ActionMap</code>.</li>
<li>Zero or more keystrokes that should trigger the action.</li>
</ol>
<p>Here for example, the Runnable sets the text “Action A triggered” in the panel label. It is added under the name “Action A”, and triggered by the “SPACE” key, or the “A” key by default. The <a href="https://github.com/scijava/ui-behaviour/wiki/InputTrigger-syntax">syntax for key strokes is described here</a>.</p>
<p>Let’s add a few more actions.</p>
<div id="9175be4f" class="cell" data-execution_count="11">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>actions<span class="op">.</span><span class="fu">runnableAction</span><span class="op">(</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">()</span> <span class="op">-&gt;</span> panel<span class="op">.</span><span class="fu">setText</span><span class="op">(</span> <span class="st">"Action B triggered"</span> <span class="op">),</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Action B"</span><span class="op">,</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B"</span><span class="op">,</span> <span class="st">"shift B"</span> <span class="op">);</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>actions<span class="op">.</span><span class="fu">runnableAction</span><span class="op">(</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">()</span> <span class="op">-&gt;</span> panel<span class="op">.</span><span class="fu">setText</span><span class="op">(</span> <span class="st">"Action C triggered"</span> <span class="op">),</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Action C"</span><span class="op">,</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"1"</span><span class="op">,</span> <span class="st">"2"</span><span class="op">,</span> <span class="st">"3"</span><span class="op">,</span> <span class="st">"4"</span><span class="op">,</span> <span class="st">"5"</span><span class="op">,</span> <span class="st">"6"</span><span class="op">,</span> <span class="st">"7"</span><span class="op">,</span> <span class="st">"8"</span><span class="op">,</span> <span class="st">"9"</span><span class="op">,</span> <span class="st">"0"</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Now we can use these defined shortcuts to run these three actions (which will change the text label to “Action A/B/C triggered”.</p>
<p><img src="Action-A-triggered.png" class="img-fluid" alt="MainPanel showing text “Action A triggered”"> <br> You can find the full <a href="https://github.com/tpietzsch/keyconfig-examples/blob/main/src/main/java/tpietzsch/Example1_SettingUpActions.java">example on github</a>.</p>
</section>
<section id="making-shortcuts-configurable" class="level2">
<h2 class="anchored" data-anchor-id="making-shortcuts-configurable">Making shortcuts configurable</h2>
<p>Another goal of ui-behaviour is to make mouse and key bindings easily configurable <em>by the user</em> (for example through config files).</p>
<p>This is the purpose of the <code>Actions</code> constructor arguments</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> action <span class="op">=</span> <span class="kw">new</span> <span class="fu">Actions</span><span class="op">(</span> <span class="kw">new</span> <span class="fu">InputTriggerConfig</span><span class="op">(),</span> <span class="st">"demo"</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The first argument is a <code>InputTriggerConfig</code>, and after that one or more <code>String</code> contexts are given (more on that later).</p>
<p>The <code>InputTriggerConfig</code> contains is basically a map from action names to key bindings. When adding a new action, for example like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>actions<span class="op">.</span><span class="fu">runnableAction</span><span class="op">(</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">()</span> <span class="op">-&gt;</span> mainPanel<span class="op">.</span><span class="fu">setText</span><span class="op">(</span> <span class="st">"Action B triggered"</span> <span class="op">),</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Action B"</span><span class="op">,</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"B"</span><span class="op">,</span> <span class="st">"shift B"</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>then <code>actions</code> will first look into its <code>InputTriggerConfig</code> to check whether any key binding is associated with the respective action name (“Action B”). If nothing is defined in the <code>InputTriggerConfig</code> then (and only then) the specified default key bindings will be used (<code>"B"</code> and <code>"shift B"</code>).</p>
<section id="loading-shortcuts-from-a-config-file" class="level3">
<h3 class="anchored" data-anchor-id="loading-shortcuts-from-a-config-file">Loading shortcuts from a config file</h3>
<p>So far, we just used a new, empty <code>InputTriggerConfig</code>, meaning we just get the specified defaults, which is exactly what we want for prototyping. If the project becomes more mature, and we want to change the config from outside, we can load the <code>InputTriggerConfig</code> from a config file.</p>
<div id="241e57ef" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">behaviour</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">yaml</span><span class="op">.</span><span class="im">YamlConfigIO</span><span class="op">;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Reader</span> reader <span class="op">=</span> <span class="kw">new</span> <span class="bu">FileReader</span><span class="op">(</span> <span class="st">"config.yaml"</span> <span class="op">);</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> config <span class="op">=</span> <span class="kw">new</span> <span class="fu">InputTriggerConfig</span><span class="op">(</span> YamlConfigIO<span class="op">.</span><span class="fu">read</span><span class="op">(</span> reader <span class="op">)</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>config.yaml</code> file looks like this:</p>
<pre><code>---
- !mapping
action: Action A
contexts: [demo]
triggers: [SPACE, A]
- !mapping
action: Action B
contexts: [demo]
triggers: [N]</code></pre>
<p>The format should be more or less self-explanatory.</p>
<p>The loaded <code>config</code> should now map the String <code>"Action A"</code> to the Set of Strings <code>{"SPACE", "A"}</code>, and <code>"Action B"</code> to <code>{"N"}</code>. We could set up <code>actions</code> with the loaded <code>config</code> in the constructor, and then define the same actions as in the previous example.</p>
<p>Alternatively, we can just update the existing <code>Actions</code> with the new config.</p>
<div id="698b3bb3" class="cell" data-execution_count="13">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>actions<span class="op">.</span><span class="fu">updateKeyConfig</span><span class="op">(</span>config<span class="op">,</span> <span class="kw">false</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>config</code> contains bindings for “Action A” and “Action B”. These will override the specified default bindings. So “Action A” will be triggered by the “SPACE” or “A” keys, and “Action B” will be triggered by “N”.</p>
<p>The <code>config</code> doesn’t specify anything for “Action C”, so that will be triggered by the programmatically specified defaults, that is, “1”, “2”, etc.</p>
</section>
<section id="action-context" class="level3">
<h3 class="anchored" data-anchor-id="action-context">Action context</h3>
<p>Besides the <code>InputTriggerConfig</code>, the <code>Actions</code> constructor also requires one ore more <code>String... context</code> arguments.</p>
<p>The idea is that the same action (or at least action name) might occur in different contexts, that is, different tools, different windows of the same tool, etc. For example, an action named “Undo” could occur in many contexts and it would be nice to be able to assign different shortcuts, depending on context.</p>
<p>Therefore, an <code>InputTriggerConfig</code> does not directly map <code>action</code> to shortcuts, but rather maps <code>(action, context)</code> pairs to shortcuts, where <code>action</code> and <code>context</code> are both <code>String</code>s. So, for example, <code>("Undo", "bdv")</code> can map to a different shortcut than <code>("Undo", "paintera")</code>.</p>
<p>The <code>context</code> arguments given in the <code>Actions</code> constructor specify which subsets of key bindings defined in the <code>InputTriggerConfig</code> should be considered. In the above example, we have</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> actions <span class="op">=</span> <span class="kw">new</span> <span class="fu">Actions</span><span class="op">(</span> config<span class="op">,</span> <span class="st">"demo"</span> <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This <code>actions</code> will pick up bindings for <code>("Undo", "demo")</code> from the config, but not <code>("Undo", "bdv")</code> for example.</p>
</section>
<section id="disabled-actions" class="level3">
<h3 class="anchored" data-anchor-id="disabled-actions">Disabled actions</h3>
<p>There is a special trigger <code>"not mapped"</code> that can be used to specify that a particular action should not be associated to any shortcut. For example, if we add</p>
<pre><code>- !mapping
action: Action C
contexts: [demo]
triggers: [not mapped]</code></pre>
<p>to the <code>config.yaml</code> file, then “Action C” will be disabled, that is, the programmatic defaults “1”, “2”, etc., will not be used.</p>
<p>You can find the full <a href="https://github.com/tpietzsch/keyconfig-examples/blob/main/src/main/java/tpietzsch/Example2_UsingConfigFiles.java">example on github</a>.</p>
</section>
</section>
<section id="configuring-shortcuts-through-the-ui" class="level2">
<h2 class="anchored" data-anchor-id="configuring-shortcuts-through-the-ui">Configuring shortcuts through the UI</h2>
<p>Being able to define shortcuts through a config file is useful. The config files can be edited, and distributed between different users or computers.</p>
<p>Even more comfortable is to be able to modify shortcuts directly through the UI, at runtime.</p>
<section id="preferences-dialog" class="level3">
<h3 class="anchored" data-anchor-id="preferences-dialog">Preferences dialog</h3>
<p>For this, we use <code>bdv.ui.settings.SettingsPanel</code>. This panel implements a typical Preferences layout (like it’s used in Eclipse, for example) with a tree of preferences sections on the left, the selected section on the right, and <em>Apply, Ok, Cancel</em> buttons on the bottom.</p>
<p>The following <code>PrefererencesDialog</code> contains only the <code>SettingsPanel</code>, and a method <code>addPage()</code> to adds new sections (<code>bdv.ui.settings.SettingsPage</code>) to the preferences tree.</p>
<div id="b4283261" class="cell" data-execution_count="14">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co">*/</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">awt</span><span class="op">.</span><span class="im">Frame</span><span class="op">;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">awt</span><span class="op">.</span><span class="im">event</span><span class="op">.</span><span class="im">WindowAdapter</span><span class="op">;</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">awt</span><span class="op">.</span><span class="im">event</span><span class="op">.</span><span class="im">WindowEvent</span><span class="op">;</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">javax</span><span class="op">.</span><span class="im">swing</span><span class="op">.</span><span class="im">JDialog</span><span class="op">;</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">javax</span><span class="op">.</span><span class="im">swing</span><span class="op">.</span><span class="im">WindowConstants</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="8124a4e4" class="cell" data-execution_count="15">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">bdv</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">settings</span><span class="op">.</span><span class="im">SettingsPage</span><span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">bdv</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">settings</span><span class="op">.</span><span class="im">SettingsPanel</span><span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> PreferencesDialog <span class="kw">extends</span> <span class="bu">JDialog</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">private</span> <span class="dt">final</span> SettingsPanel settingsPanel<span class="op">;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">PreferencesDialog</span><span class="op">(</span> <span class="dt">final</span> <span class="bu">Frame</span> owner <span class="op">)</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">(</span> owner<span class="op">,</span> <span class="st">"Preferences"</span><span class="op">,</span> <span class="kw">false</span> <span class="op">);</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>        settingsPanel <span class="op">=</span> <span class="kw">new</span> <span class="fu">SettingsPanel</span><span class="op">();</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        settingsPanel<span class="op">.</span><span class="fu">onOk</span><span class="op">(</span> <span class="op">()</span> <span class="op">-&gt;</span> <span class="fu">setVisible</span><span class="op">(</span> <span class="kw">false</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>        settingsPanel<span class="op">.</span><span class="fu">onCancel</span><span class="op">(</span> <span class="op">()</span> <span class="op">-&gt;</span> <span class="fu">setVisible</span><span class="op">(</span> <span class="kw">false</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        <span class="fu">setDefaultCloseOperation</span><span class="op">(</span> <span class="bu">WindowConstants</span><span class="op">.</span><span class="fu">HIDE_ON_CLOSE</span> <span class="op">);</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">addWindowListener</span><span class="op">(</span> <span class="kw">new</span> <span class="bu">WindowAdapter</span><span class="op">()</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">@Override</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>            <span class="kw">public</span> <span class="dt">void</span> <span class="fu">windowClosing</span><span class="op">(</span> <span class="dt">final</span> <span class="bu">WindowEvent</span> e <span class="op">)</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>                settingsPanel<span class="op">.</span><span class="fu">cancel</span><span class="op">();</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span> <span class="op">);</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        <span class="fu">getContentPane</span><span class="op">().</span><span class="fu">add</span><span class="op">(</span> settingsPanel<span class="op">,</span> <span class="bu">BorderLayout</span><span class="op">.</span><span class="fu">CENTER</span> <span class="op">);</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pack</span><span class="op">();</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">addPage</span><span class="op">(</span> <span class="dt">final</span> SettingsPage page <span class="op">)</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>        settingsPanel<span class="op">.</span><span class="fu">addPage</span><span class="op">(</span> page <span class="op">);</span></span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">pack</span><span class="op">();</span></span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Let’s instantiate a <code>PreferencesDialog</code> for our example, and add a keyboard shortcut (command-comma or control-comma) to show it.</p>
<div id="ce302797" class="cell" data-execution_count="16">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> preferencesDialog <span class="op">=</span> <span class="kw">new</span> <span class="fu">PreferencesDialog</span><span class="op">(</span> frame <span class="op">);</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>actions<span class="op">.</span><span class="fu">runnableAction</span><span class="op">(</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">()</span> <span class="op">-&gt;</span> preferencesDialog<span class="op">.</span><span class="fu">setVisible</span><span class="op">(</span> <span class="op">!</span>preferencesDialog<span class="op">.</span><span class="fu">isVisible</span><span class="op">()</span> <span class="op">),</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Preferences"</span><span class="op">,</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"meta COMMA"</span><span class="op">,</span> <span class="st">"ctrl COMMA"</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Next, we want to add a preferences section for configuring shortcuts. There is <code>bdv.ui.keymap.KeymapSettingsPage</code> that we can readily use. In the end this will give us something like this: <img src="keymap-prefs.png" class="preview-image img-fluid" alt="Keymap settings in the preferences dialog"> What remains to be done is to fill the settings page with a list of configurable actions.</p>
</section>
<section id="commanddescriptions" class="level3">
<h3 class="anchored" data-anchor-id="commanddescriptions">CommandDescriptions</h3>
<p>Specifially, we need to supply the <code>KeymapSettingsPage</code> with a list of existing actions, with short textual descriptions. This is done by creating a <code>CommandDescriptions</code> object and adding the configurable actions.</p>
<div id="7acf71c7" class="cell" data-execution_count="17">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">behaviour</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">gui</span><span class="op">.</span><span class="im">CommandDescriptions</span><span class="op">;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> descriptions <span class="op">=</span> <span class="kw">new</span> <span class="fu">CommandDescriptions</span><span class="op">();</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>descriptions<span class="op">.</span><span class="fu">setKeyconfigContext</span><span class="op">(</span> <span class="st">"demo"</span> <span class="op">);</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>descriptions<span class="op">.</span><span class="fu">add</span><span class="op">(</span> <span class="st">"Action A"</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"SPACE"</span> <span class="op">},</span> <span class="st">"trigger Action A"</span> <span class="op">);</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>descriptions<span class="op">.</span><span class="fu">add</span><span class="op">(</span> <span class="st">"Action B"</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"B"</span><span class="op">,</span> <span class="st">"shift B"</span> <span class="op">},</span> <span class="st">"trigger Action B"</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For each action, we add its name and default shortcuts in the same way we did when creating the action, and a short description (this is just for showing to the user, so can be left empty if you’re lazy…).</p>
<p>The other thing we need to supply to the <code>KeymapSettingsPage</code> is a <code>KeymapManager</code>. <code>KeymapManager</code> maintains a set of named <code>Keymaps</code> (some built-in, some user-defined). A <code>Keymap</code> is a simple container for a <code>InputTriggerConfig</code>, adding just a name and support for listeners to be notified when the <code>InputTriggerConfig</code> changes.</p>
<p>Our <code>KeymapManager</code> extends the existing <code>AbstractKeymapManager</code> base class. The only thing that needs to be done is providing one or more default <code>Keymap</code>s. We can build a default keymap from the above <code>descriptions</code>. (But they could also be loaded from resources, build manually, …)</p>
<div id="41afa265" class="cell" data-execution_count="18">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">bdv</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">keymap</span><span class="op">.</span><span class="im">AbstractKeymapManager</span><span class="op">;</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">bdv</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">keymap</span><span class="op">.</span><span class="im">Keymap</span><span class="op">;</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> defaultKeymap <span class="op">=</span> <span class="kw">new</span> <span class="bu">Keymap</span><span class="op">(</span> <span class="st">"Default"</span><span class="op">,</span> descriptions<span class="op">.</span><span class="fu">createDefaultKeyconfig</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Manages a collection of <span class="an">{@link</span> Keymap<span class="an">}</span><span class="co">.</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> KeymapManager <span class="kw">extends</span> AbstractKeymapManager<span class="op">&lt;</span> KeymapManager <span class="op">&gt;</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">protected</span> <span class="bu">List</span><span class="op">&lt;</span> <span class="bu">Keymap</span> <span class="op">&gt;</span> <span class="fu">loadBuiltinStyles</span><span class="op">()</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">Collections</span><span class="op">.</span><span class="fu">singletonList</span><span class="op">(</span> defaultKeymap <span class="op">);</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">saveStyles</span><span class="op">()</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>        <span class="co">// not implemented.</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Here we would save user defined keymaps to YAML files, for example.</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We create a <code>KeyMapManager</code> instance and add it to the Preferences dialog (via <code>KeymapSettingsPage</code>).</p>
<div id="a5099212" class="cell" data-execution_count="19">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">bdv</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">keymap</span><span class="op">.</span><span class="im">KeymapSettingsPage</span><span class="op">;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> keymapManager <span class="op">=</span> <span class="kw">new</span> <span class="fu">KeymapManager</span><span class="op">();</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>preferencesDialog<span class="op">.</span><span class="fu">addPage</span><span class="op">(</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>        <span class="kw">new</span> <span class="fu">KeymapSettingsPage</span><span class="op">(</span> <span class="st">"Keymap"</span><span class="op">,</span> keymapManager<span class="op">,</span> <span class="kw">new</span> <span class="fu">KeymapManager</span><span class="op">(),</span> descriptions <span class="op">)</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The <code>KeyMapManager</code> (via its base class) exposes the user-selected keymap. We set that for our <code>actions</code> object. We also add a listener that refreshes <code>actions</code> keybinding when that keymap changes.</p>
<div id="28c7f754" class="cell" data-execution_count="20">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> keymap <span class="op">=</span> keymapManager<span class="op">.</span><span class="fu">getForwardSelectedKeymap</span><span class="op">();</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>actions<span class="op">.</span><span class="fu">updateKeyConfig</span><span class="op">(</span> keymap<span class="op">.</span><span class="fu">getConfig</span><span class="op">(),</span> <span class="kw">false</span> <span class="op">);</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>keymap<span class="op">.</span><span class="fu">updateListeners</span><span class="op">().</span><span class="fu">add</span><span class="op">(</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">()</span> <span class="op">-&gt;</span> actions<span class="op">.</span><span class="fu">updateKeyConfig</span><span class="op">(</span> keymap<span class="op">.</span><span class="fu">getConfig</span><span class="op">(),</span> <span class="kw">false</span> <span class="op">)</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>true</code></pre>
</div>
</div>
<p>That’s it. The user can now use the Preferences dialog to define custom keymaps with shortcuts to their liking, and switch between different keymaps. (Use command-comma or control-comma to show the preferences dialog).</p>
<p>You can find the full <a href="https://github.com/tpietzsch/keyconfig-examples/blob/main/src/main/java/tpietzsch/Example3_PreferencesDialog.java">example on github</a>.</p>
</section>
</section>
<section id="making-action-descriptions-discoverable" class="level2">
<h2 class="anchored" data-anchor-id="making-action-descriptions-discoverable">Making action descriptions discoverable</h2>
<p>Keeping the list of existing actions (that is, the <code>CommandDescriptions</code>) up to date is tedious. Actions that should appear in the config dialog may be scattered through your own code and dependencies. This can be somewhat automated with <code>CommandDescriptionProvider</code>s. These are scijava <code>@Plugin</code>s that can be discovered at runtime.</p>
<div id="a985620f" class="cell" data-execution_count="21">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">plugin</span><span class="op">.</span><span class="im">Plugin</span><span class="op">;</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">behaviour</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">gui</span><span class="op">.</span><span class="im">CommandDescriptionProvider</span><span class="op">;</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> DEMO_SCOPE <span class="op">=</span> <span class="kw">new</span> CommandDescriptionProvider<span class="op">.</span><span class="fu">Scope</span><span class="op">(</span> <span class="st">"tpietzsch.keymap"</span> <span class="op">);</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> DEMO_CONTEXT <span class="op">=</span> <span class="st">"demo"</span><span class="op">;</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="co">/*</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a><span class="co"> * Command descriptions for all provided commands</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co"> */</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="at">@Plugin</span><span class="op">(</span> type <span class="op">=</span> CommandDescriptionProvider<span class="op">.</span><span class="fu">class</span> <span class="op">)</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="kw">class</span> MyActionDescriptions <span class="kw">extends</span> CommandDescriptionProvider</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">MyActionDescriptions</span><span class="op">()</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">(</span> DEMO_SCOPE<span class="op">,</span> DEMO_CONTEXT <span class="op">);</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">void</span> <span class="fu">getCommandDescriptions</span><span class="op">(</span> <span class="dt">final</span> CommandDescriptions descriptions <span class="op">)</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>        descriptions<span class="op">.</span><span class="fu">add</span><span class="op">(</span> <span class="st">"Action A"</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"SPACE"</span> <span class="op">},</span> <span class="st">"trigger Action A"</span> <span class="op">);</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>        descriptions<span class="op">.</span><span class="fu">add</span><span class="op">(</span> <span class="st">"Action B"</span><span class="op">,</span> <span class="kw">new</span> <span class="bu">String</span><span class="op">[]</span> <span class="op">{</span> <span class="st">"B"</span><span class="op">,</span> <span class="st">"shift B"</span> <span class="op">},</span> <span class="st">"trigger Action B"</span> <span class="op">);</span></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>For discovery, we use a <code>CommandDescriptionsBuilder</code></p>
<div id="a5f06ad5" class="cell" data-execution_count="22">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">Context</span><span class="op">;</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">plugin</span><span class="op">.</span><span class="im">PluginService</span><span class="op">;</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">behaviour</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">gui</span><span class="op">.</span><span class="im">CommandDescriptionsBuilder</span><span class="op">;</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> context <span class="op">=</span> <span class="kw">new</span> <span class="bu">Context</span><span class="op">(</span> PluginService<span class="op">.</span><span class="fu">class</span> <span class="op">);</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> builder <span class="op">=</span> <span class="kw">new</span> <span class="fu">CommandDescriptionsBuilder</span><span class="op">();</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>context<span class="op">.</span><span class="fu">inject</span><span class="op">(</span> builder <span class="op">);</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">discoverProviders</span><span class="op">(</span> DEMO_SCOPE <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Note the use of <code>DEMO_SCOPE</code> here. The same scope is also given in the <code>MyActionDescriptions</code> constructor. The <code>discoverProviders()</code> method takes an optional scope argument, and will only discover <code>CommandDescriptionProvider</code> that match this scope. If no scope is given, all <code>CommandDescriptionProvider</code> on the classpath will be discovered. For example within Fiji, that would include actions from Mastodon and BigDataViewer.</p>
<p>Unfortunately, the <code>@Plugin</code> annotations do not work for classes defined in JShell (used by this notebook). As a workaround, we can add <code>MyActionDescriptions</code> manually.</p>
<div id="d372e92d" class="cell" data-execution_count="23">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>builder<span class="op">.</span><span class="fu">addManually</span><span class="op">(</span> <span class="kw">new</span> <span class="fu">MyActionDescriptions</span><span class="op">(),</span> DEMO_CONTEXT <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>After we add everything we need to the builder, we can get the <code>Descriptions</code>.</p>
<div id="258377a7" class="cell" data-execution_count="24">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> descriptions <span class="op">=</span> builder<span class="op">.</span><span class="fu">build</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>You can find the full <a href="https://github.com/tpietzsch/keymap-idiom/blob/main/src/main/java/tpietzsch/Example4_DiscoveringActions.java">example on github</a>.</p>
</section>
<section id="recommended-pattern-for-defining-actions" class="level2">
<h2 class="anchored" data-anchor-id="recommended-pattern-for-defining-actions">Recommended pattern for defining actions</h2>
<p>Action definitions in BigDataViewer and Mastodon are organized in the following way.</p>
<p>A set of related actions is collected into a <code>MyActions</code> (for example) class. Action names and default shortcuts are defined as <code>public static final</code> constants, because they are used both for defining the actions, and for creating action <code>Descriptions</code>.</p>
<p>The actions contained in <code>MyActions</code> are described in a <code>public static</code> inner class <code>Descriptions extends CommandDescriptionProvider</code>.</p>
<p>In the <code>Descriptions</code> constructor, we give a scope for the respective library / tool. Ideally, the scope should be defined <code>public static</code> somewhere so that is can easily used outside the component to discover its actions. For example, BigDataViewer uses <a href="https://github.com/bigdataviewer/bigdataviewer-core/blob/5ee31596be002fc15502c4a5ffc08a888f12921b/src/main/java/bdv/KeyConfigScopes.java#L38">this scope</a>. If another tool (BigStitcher, BigWarp, etc.) wants to include BDV shortcuts into its customizable keymaps, they can be easily discovered like that.</p>
<div id="e5e42022" class="cell" data-execution_count="25">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">plugin</span><span class="op">.</span><span class="im">Plugin</span><span class="op">;</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">org</span><span class="op">.</span><span class="im">scijava</span><span class="op">.</span><span class="im">ui</span><span class="op">.</span><span class="im">behaviour</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">gui</span><span class="op">.</span><span class="im">CommandDescriptionProvider</span><span class="op">;</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="dt">var</span> DEMO_SCOPE <span class="op">=</span> <span class="kw">new</span> CommandDescriptionProvider<span class="op">.</span><span class="fu">Scope</span><span class="op">(</span> <span class="st">"tpietzsch.keymap-idiom"</span> <span class="op">);</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="dt">var</span> DEMO_CONTEXT <span class="op">=</span> <span class="st">"demo"</span><span class="op">;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MyActions</span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// define action name constants</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> ACTION_A <span class="op">=</span> <span class="st">"Action A"</span><span class="op">;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> ACTION_B <span class="op">=</span> <span class="st">"Action B"</span><span class="op">;</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span> PREFERENCES <span class="op">=</span> <span class="st">"Preferences"</span><span class="op">;</span></span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// define default shortcut constants</span></span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> ACTION_A_KEYS <span class="op">=</span> <span class="op">{</span> <span class="st">"SPACE"</span> <span class="op">};</span></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> ACTION_B_KEYS <span class="op">=</span> <span class="op">{</span> <span class="st">"B"</span><span class="op">,</span> <span class="st">"shift B"</span> <span class="op">};</span></span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> PREFERENCES_KEYS <span class="op">=</span> <span class="op">{</span> <span class="st">"meta COMMA"</span><span class="op">,</span> <span class="st">"ctrl COMMA"</span> <span class="op">};</span></span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">/*</span></span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a><span class="co">     * Command descriptions for all provided commands</span></span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a><span class="co">     */</span></span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Plugin</span><span class="op">(</span> type <span class="op">=</span> CommandDescriptionProvider<span class="op">.</span><span class="fu">class</span> <span class="op">)</span></span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="kw">class</span> Descriptions <span class="kw">extends</span> CommandDescriptionProvider</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="fu">Descriptions</span><span class="op">()</span></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>            <span class="kw">super</span><span class="op">(</span> DEMO_SCOPE<span class="op">,</span> DEMO_CONTEXT <span class="op">);</span></span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">@Override</span></span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>        <span class="kw">public</span> <span class="dt">void</span> <span class="fu">getCommandDescriptions</span><span class="op">(</span> <span class="dt">final</span> CommandDescriptions descriptions <span class="op">)</span></span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a>            descriptions<span class="op">.</span><span class="fu">add</span><span class="op">(</span> ACTION_A<span class="op">,</span> ACTION_A_KEYS<span class="op">,</span> <span class="st">"trigger Action A"</span> <span class="op">);</span></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a>            descriptions<span class="op">.</span><span class="fu">add</span><span class="op">(</span> ACTION_B<span class="op">,</span> ACTION_B_KEYS<span class="op">,</span> <span class="st">"trigger Action B"</span> <span class="op">);</span></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>            descriptions<span class="op">.</span><span class="fu">add</span><span class="op">(</span> PREFERENCES<span class="op">,</span> PREFERENCES_KEYS<span class="op">,</span> <span class="st">"Show the Preferences dialog."</span> <span class="op">);</span></span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb32-40"><a href="#cb32-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-41"><a href="#cb32-41" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-42"><a href="#cb32-42" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb32-43"><a href="#cb32-43" aria-hidden="true" tabindex="-1"></a>     <span class="co">*</span> Install into the specified <span class="an">{@link</span> Actions<span class="an">}</span><span class="co">.</span></span>
<span id="cb32-44"><a href="#cb32-44" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span>
<span id="cb32-45"><a href="#cb32-45" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">install</span><span class="op">(</span> <span class="dt">final</span> Actions actions<span class="op">,</span> <span class="dt">final</span> MainPanel mainPanel<span class="op">,</span> <span class="dt">final</span> PreferencesDialog preferencesDialog <span class="op">)</span></span>
<span id="cb32-46"><a href="#cb32-46" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb32-47"><a href="#cb32-47" aria-hidden="true" tabindex="-1"></a>        actions<span class="op">.</span><span class="fu">runnableAction</span><span class="op">(</span> <span class="op">()</span> <span class="op">-&gt;</span> mainPanel<span class="op">.</span><span class="fu">setText</span><span class="op">(</span> <span class="st">"Action A triggered"</span> <span class="op">),</span></span>
<span id="cb32-48"><a href="#cb32-48" aria-hidden="true" tabindex="-1"></a>                ACTION_A<span class="op">,</span> ACTION_A_KEYS <span class="op">);</span></span>
<span id="cb32-49"><a href="#cb32-49" aria-hidden="true" tabindex="-1"></a>        actions<span class="op">.</span><span class="fu">runnableAction</span><span class="op">(</span> <span class="op">()</span> <span class="op">-&gt;</span> mainPanel<span class="op">.</span><span class="fu">setText</span><span class="op">(</span> <span class="st">"Action B triggered"</span> <span class="op">),</span></span>
<span id="cb32-50"><a href="#cb32-50" aria-hidden="true" tabindex="-1"></a>                ACTION_B<span class="op">,</span> ACTION_B_KEYS <span class="op">);</span></span>
<span id="cb32-51"><a href="#cb32-51" aria-hidden="true" tabindex="-1"></a>        actions<span class="op">.</span><span class="fu">runnableAction</span><span class="op">(</span> <span class="op">()</span> <span class="op">-&gt;</span> preferencesDialog<span class="op">.</span><span class="fu">setVisible</span><span class="op">(</span> <span class="op">!</span>preferencesDialog<span class="op">.</span><span class="fu">isVisible</span><span class="op">()</span> <span class="op">),</span></span>
<span id="cb32-52"><a href="#cb32-52" aria-hidden="true" tabindex="-1"></a>                PREFERENCES<span class="op">,</span> PREFERENCES_KEYS <span class="op">);</span></span>
<span id="cb32-53"><a href="#cb32-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb32-54"><a href="#cb32-54" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p><code>MyActions</code> contains one <code>install</code> method that installs all actions into a provided <code>Actions</code> argument. Ideally, <code>MyActions</code> is stateless, and <code>install</code> method is <code>static</code>.</p>
<p>The remaining arguments to <code>install</code> are whatever is needed to create the actions. In the example, the <code>mainPanel</code> is needed to create “Action A” and “Action B”, and the <code>preferencesDialog</code> is needed to create the action to show/hide it.</p>
<p>So, <code>MyActions.install(...)</code> is called to install into a provided <code>Actions</code>. Usually every frame/panel in the application should have an <code>Actions</code> instance, which is linked to the <code>KeymapManager</code> so that keymap updates propagate correctly.</p>
<p>And that’s it… This is currently the recommended way to structure and bundle action definitions. You can find the full <a href="https://github.com/tpietzsch/keymap-idiom/blob/main/src/main/java/tpietzsch/RecommendedPattern.java">example on github</a>.</p>
<p>See BigDataViewer’s <a href="https://github.com/bigdataviewer/bigdataviewer-core/blob/6d3c9b1904ff9e6e1617c2810c595c15080764c5/src/main/java/bdv/viewer/NavigationActions.java">NavigationActions</a> as an example “in the wild”. For behaviours (mouse gestures, etc.) the structure is the same. See BigDataViewer’s <a href="https://github.com/bigdataviewer/bigdataviewer-core/blob/d65e530df8a27726509f477e92c888d280b98162/src/main/java/bdv/TransformEventHandler2D.java">TransformEventHandler2D</a> for example.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>