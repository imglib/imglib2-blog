<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John Bogovic">
<meta name="dcterms.date" content="2024-02-27">
<meta name="description" content="Basics of the N5 API for Java developers. This tutorial shows how to read and write array data and metadata using N5.">

<title>ImgLib2 news and tutorials - N5 API Basics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../favicon.ico" rel="icon">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="ImgLib2 news and tutorials - N5 API Basics">
<meta property="og:description" content="Basics of the N5 API for Java developers. This tutorial shows how to read and write array data and metadata using N5.">
<meta property="og:image" content="https://imglib.github.io/imglib2-blog/posts/2024-02-25-n5-tutorial-basic-1/n5-basic-tutorial-thumbnail.png">
<meta property="og:site_name" content="ImgLib2 news and tutorials">
<meta property="og:image:height" content="301">
<meta property="og:image:width" content="673">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../imglib2-logo-header.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ImgLib2 news and tutorials</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">ImgLib2</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/imglib"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@imglib2"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../index.xml"> <i class="bi bi-rss" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <div class="quarto-title-block"><div><h1 class="title">N5 API Basics</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button" data-quarto-source-url="https://github.com/imglib/imglib2-blog/blob/main/posts/2024-02-25-n5-tutorial-basic-1/index.qmd">View Source</a></li></ul></div></div>
                  <div>
        <div class="description">
          Basics of the N5 API for Java developers. This tutorial shows how to read and write array data and metadata using N5.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">hdf5</div>
                <div class="quarto-category">n5</div>
                <div class="quarto-category">zarr</div>
                <div class="quarto-category">imglib2</div>
                <div class="quarto-category">tutorial</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>John Bogovic </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">February 27, 2024</p>
      </div>
    </div>
    
      <div>
      <div class="quarto-title-meta-heading">Modified</div>
      <div class="quarto-title-meta-contents">
        <p class="date-modified">February 27, 2024</p>
      </div>
    </div>
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        
    <div class="quarto-alternate-notebooks"><h2>Notebooks</h2><ul><li><a href="N5-Basics-Tutorial-preview.html"><i class="bi bi-journal-code"></i>N5-Basics-Tutorial.ipynb</a></li></ul></div></div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<p>This tutorial for Java developers covers the most basic functionality of the <a href="https://github.com/saalfeldlab/n5">N5 API</a>. We will learn about:</p>
<ul>
<li>creating readers and writers</li>
<li>modifying and inspecting the hierarchy (“folder structure”)</li>
<li>saving and loading array data</li>
<li>saving and loading metadata</li>
</ul>
<section id="readers-and-writers" class="level2">
<h2 class="anchored" data-anchor-id="readers-and-writers">Readers and writers</h2>
<p><a href="https://github.com/saalfeldlab/n5/blob/8e14d529276b57e1817ff21df9cac9fb1a517d59/src/main/java/org/janelia/saalfeldlab/n5/N5Reader.java"><code>N5Reader</code></a>s and <a href="https://github.com/saalfeldlab/n5/blob/8e14d529276b57e1817ff21df9cac9fb1a517d59/src/main/java/org/janelia/saalfeldlab/n5/N5Writer.java"><code>N5Writer</code></a>s form the basis of the N5 API and allow you to read and write data, respectively. We generally recommend using an <a href="https://github.com/saalfeldlab/n5-universe/blob/176ff469bb711eea3320535756b2e2594cb4eb61/src/main/java/org/janelia/saalfeldlab/n5/universe/N5Factory.java"><code>N5Factory</code></a> to create readers and writers:</p>
<div class="quarto-embed-nb-cell">
<div id="89830e81" class="cell" data-tags="[&quot;make-reader-writer&quot;]" data-execution_count="4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co">// N5Factory can make N5Readers and N5Writers</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> factory <span class="op">=</span> <span class="kw">new</span> <span class="fu">N5Factory</span><span class="op">();</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">// trying to open a reader for a container that does not yet exist will throw an error </span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">// var n5Reader = factory.openReader("my-container.n5");</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">// creating a writer creates a container at the given location</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">// if it does not already exist</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> n5Writer <span class="op">=</span> factory<span class="op">.</span><span class="fu">openWriter</span><span class="op">(</span><span class="st">"my-container.n5"</span><span class="op">);</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">// now we can make a reader</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> n5Reader <span class="op">=</span> factory<span class="op">.</span><span class="fu">openReader</span><span class="op">(</span><span class="st">"my-container.n5"</span><span class="op">);</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">// test if the container exists</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>n5Reader<span class="op">.</span><span class="fu">exists</span><span class="op">(</span><span class="st">""</span><span class="op">);</span> <span class="co">// true</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">// "" and "/" both refer to the root of the container</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>n5Reader<span class="op">.</span><span class="fu">exists</span><span class="op">(</span><span class="st">"/"</span><span class="op">);</span> <span class="co">// true</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>The N5 API gives you access to a number of different storage formats: HDF5, Zarr, and N5’s own format. <code>N5Factory</code>’s convenience methods try to infer the storage format from the extension of the path you give it:</p>
<div class="quarto-embed-nb-cell">
<div id="8a6621e1" class="cell" data-tags="[&quot;factory-types&quot;]" data-execution_count="5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>factory<span class="op">.</span><span class="fu">openWriter</span><span class="op">(</span><span class="st">"my-container.h5"</span><span class="op">).</span><span class="fu">getClass</span><span class="op">();</span>   <span class="co">// N5HDF5Writer</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>factory<span class="op">.</span><span class="fu">openWriter</span><span class="op">(</span><span class="st">"my-container.n5"</span><span class="op">).</span><span class="fu">getClass</span><span class="op">();</span>   <span class="co">// N5FSWriter</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>factory<span class="op">.</span><span class="fu">openWriter</span><span class="op">(</span><span class="st">"my-container.zarr"</span><span class="op">).</span><span class="fu">getClass</span><span class="op">();</span> <span class="co">// N5ZarrWriter</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>In fact, it is possible to read with <code>N5Writer</code>s since every <code>N5Writer</code> is also an <code>N5Reader</code>, so from now on, we’ll just be using the <code>n5Writer.</code></p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try it!
</div>
</div>
<div class="callout-body-container callout-body">
<p>We use the the N5 storage format for the rest of the tutorial, but it will work just as well using either an HDF5 or Zarr writer.</p>
</div>
</div>
</section>
<section id="groups" class="level2">
<h2 class="anchored" data-anchor-id="groups">Groups</h2>
<p>N5 containers form hierarchies of <em>groups</em> - think “nested folders on your file system.” It’s easy to create groups and test if they exist:</p>
<div class="quarto-embed-nb-cell">
<div id="9ee0c14d" class="cell" data-tags="[&quot;make-groups&quot;]" data-execution_count="6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">createGroup</span><span class="op">(</span><span class="st">"foo"</span><span class="op">);</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">createGroup</span><span class="op">(</span><span class="st">"foo/bar"</span><span class="op">);</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">createGroup</span><span class="op">(</span><span class="st">"lorum/ipsum/dolor/sit/amet"</span><span class="op">);</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">exists</span><span class="op">(</span><span class="st">"lorum/ipsum"</span><span class="op">);</span>      <span class="co">// true</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">exists</span><span class="op">(</span><span class="st">"not/a/real/group"</span><span class="op">);</span> <span class="co">// false</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>The <code>list</code> method lists groups that are children of the given group:</p>
<div class="quarto-embed-nb-cell">
<div id="72496634" class="cell" data-tags="[&quot;list&quot;]" data-execution_count="7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">list</span><span class="op">(</span><span class="st">""</span><span class="op">);</span>     <span class="co">// [lorum, foo]</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">list</span><span class="op">(</span><span class="st">"foo"</span><span class="op">);</span>  <span class="co">// [bar]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>and <code>deepList</code> recursively lists every descendent of the given group:</p>
<div class="quarto-embed-nb-cell">
<div id="1f363282" class="cell" data-tags="[&quot;deep-list&quot;]" data-execution_count="8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="bu">Arrays</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>n5Writer<span class="op">.</span><span class="fu">deepList</span><span class="op">(</span><span class="st">""</span><span class="op">));</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">
<pre><code>[lorum, lorum/ipsum, lorum/ipsum/dolor, lorum/ipsum/dolor/sit, lorum/ipsum/dolor/sit/amet, foo, foo/bar]</code></pre>
</div>
</div>
</div>
<p>Notice that these methods <em>only</em> give information about what groups are present and do not provide information about metadata or array data.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some storage / access systems (AWS-S3) separate permissions for reading and listing, meaning it may be possible to access data but not list.</p>
</div>
</div>
</section>
<section id="arrays" class="level2">
<h2 class="anchored" data-anchor-id="arrays">Arrays</h2>
<p>N5 stores arrays in particular groups in the hierarchy. We call groups that contain arrays “datasets” - <a href="https://docs.hdfgroup.org/hdf5/develop/_g_l_s.html#title3">terminology inherited from HDF5</a>.</p>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>Datasets must be terminal (leaf) nodes in the container hierarchy - i.e.&nbsp;a dataset can not contain another group or dataset.</p>
</div>
</div>
<p>We recommend using <a href="https://github.com/saalfeldlab/n5-ij">n5-ij</a> or <a href="https://github.com/saalfeldlab/n5-imglib2">n5-imglib2</a> to write arrays. The examples in this post will use the latter.</p>
<p>The <a href="https://github.com/saalfeldlab/n5-imglib2/blob/241dc2b503d01007ec6aec72dacecc9706f023ab/src/main/java/org/janelia/saalfeldlab/n5/imglib2/N5Utils.java"><code>N5Utils</code></a> class in n5-imglib2 has many useful methods, but in this post, we’ll cover simple methods for reading and writing. First, <a href="https://github.com/saalfeldlab/n5-imglib2/blob/241dc2b503d01007ec6aec72dacecc9706f023ab/src/main/java/org/janelia/saalfeldlab/n5/imglib2/N5Utils.java#L1440"><code>N5Utils.save</code></a> writes an array and required array metadata to the container at a group that you specify. The group will be created if it does not already exist. The parameters will be discussed in more detail below.</p>
<div class="quarto-embed-nb-cell">
<div id="28e3835d" class="cell" data-tags="[&quot;n5-imglib2-save&quot;]" data-execution_count="10">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// the parameters</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> img <span class="op">=</span> <span class="fu">demoImage</span><span class="op">(</span><span class="dv">64</span><span class="op">,</span><span class="dv">64</span><span class="op">);</span> <span class="co">// the image to write- size 64 x 64</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> groupPath <span class="op">=</span> <span class="st">"data"</span><span class="op">;</span> </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> blockSize <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[]{</span><span class="dv">32</span><span class="op">,</span><span class="dv">32</span><span class="op">};</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> compression <span class="op">=</span> <span class="kw">new</span> <span class="fu">GzipCompression</span><span class="op">();</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">// save the image</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>N5Utils<span class="op">.</span><span class="fu">save</span><span class="op">(</span>img<span class="op">,</span> n5Writer<span class="op">,</span> groupPath<span class="op">,</span> blockSize<span class="op">,</span> compression<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>You can write blocks in parallel by providing an <a href="https://docs.oracle.com/javase/8/docs/api/java/util/concurrent/ExecutorService.html"><code>ExecutorService</code></a> to this variant of <a href="https://github.com/saalfeldlab/n5-imglib2/blob/241dc2b503d01007ec6aec72dacecc9706f023ab/src/main/java/org/janelia/saalfeldlab/n5/imglib2/N5Utils.java#L1514"><code>N5Utils.save</code></a></p>
<div class="quarto-embed-nb-cell">
<div id="131e8bd4" class="cell" data-tags="[&quot;n5-imglib2-save-exec&quot;]" data-execution_count="11">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> exec <span class="op">=</span> <span class="bu">Executors</span><span class="op">.</span><span class="fu">newFixedThreadPool</span><span class="op">(</span><span class="dv">4</span><span class="op">);</span> <span class="co">// with 4 parallel threads</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>N5Utils<span class="op">.</span><span class="fu">save</span><span class="op">(</span>img<span class="op">,</span> n5Writer<span class="op">,</span> groupPath<span class="op">,</span> blockSize<span class="op">,</span> compression<span class="op">,</span> exec<span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>Reading the array data from the container is also easy with <a href="https://github.com/saalfeldlab/n5-imglib2/blob/241dc2b503d01007ec6aec72dacecc9706f023ab/src/main/java/org/janelia/saalfeldlab/n5/imglib2/N5Utils.java#L428"><code>N5Utils.open</code></a> :</p>
<div class="quarto-embed-nb-cell">
<div id="de0fadca" class="cell" data-tags="[&quot;n5-imglib2-open&quot;]" data-execution_count="15">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> loadedImg <span class="op">=</span> N5Utils<span class="op">.</span><span class="fu">open</span><span class="op">(</span>n5Writer<span class="op">,</span> groupPath<span class="op">);</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="bu">Util</span><span class="op">.</span><span class="fu">getTypeFromInterval</span><span class="op">(</span>loadedImg<span class="op">).</span><span class="fu">getClass</span><span class="op">();</span>      <span class="co">// FloatType</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="bu">Arrays</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>loadedImg<span class="op">.</span><span class="fu">dimensionsAsLongArray</span><span class="op">());</span>  <span class="co">// [64, 64]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Overwriting data is possible
</div>
</div>
<div class="callout-body-container callout-body">
<p>This save method <em>DOES NOT</em> perform any checks prior to writing data and will overwrite data that exists in the specified location. Be sure to check and take appropriate action if it is possible that data could already at a particular location and container to avoid data loss or corruption.</p>
</div>
</div>
<p>This example shows that data can be over written:</p>
<div class="quarto-embed-nb-cell">
<div id="f861d622" class="cell" data-tags="[&quot;n5-imglib2-overwrite&quot;]" data-execution_count="16">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co">// overwrite our previous data</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> img <span class="op">=</span> ArrayImgs<span class="op">.</span><span class="fu">unsignedBytes</span><span class="op">(</span><span class="dv">2</span><span class="op">,</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>N5Utils<span class="op">.</span><span class="fu">save</span><span class="op">(</span>img<span class="op">,</span> n5Writer<span class="op">,</span> groupPath<span class="op">,</span> blockSize<span class="op">,</span> compression<span class="op">);</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co">// load the new data, the old data are no longer accessible</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> loadedImg <span class="op">=</span> N5Utils<span class="op">.</span><span class="fu">open</span><span class="op">(</span>n5Writer<span class="op">,</span> groupPath<span class="op">);</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="bu">Arrays</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>loadedImg<span class="op">.</span><span class="fu">dimensionsAsLongArray</span><span class="op">());</span>  <span class="co">// [2, 2]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<section id="parameter-details" class="level3">
<h3 class="anchored" data-anchor-id="parameter-details">Parameter details</h3>
<section id="grouppath" class="level4">
<h4 class="anchored" data-anchor-id="grouppath"><code>groupPath</code></h4>
<p>is the group inside the container that will store the array. You can store an array at the root of a container by specifying <code>""</code> or <code>"/"</code> as the <code>groupPath</code>. In this case, the container will only be able to store one array (see the warning above at the start of the “Arrays” section).</p>
</section>
<section id="blocksize" class="level4">
<h4 class="anchored" data-anchor-id="blocksize"><code>blockSize</code></h4>
<p>is a very important parameter of an array. HDF5, N5, and Zarr all break up the arrays they store into equally sized blocks or “chunks”. The block size parameter specifies the size of these blocks.</p>
<p>For the example above, we stored an image of size <code>64 x 64</code> using blocks sized <code>32 x 32</code>. As a result, N5 uses four blocks to store the entire image:</p>
<div class="quarto-embed-nb-cell">
<div id="79901ca0" class="cell" data-tags="[&quot;four-blocks&quot;]" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">printBlocks</span><span class="op">(</span><span class="st">"my-container.n5/data"</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>my-container.n5/data/1/1 is 1762 bytes
my-container.n5/data/1/0 is 2012 bytes
my-container.n5/data/0/1 is 1763 bytes
my-container.n5/data/0/0 is 2020 bytes</code></pre>
</div>
</div>
</div>
<p><em>Quiz:</em> How many blocks would there be if the block size was <code>64 x 8</code>?</p>
<details>
<summary>
Click here to show the answer.
</summary>
<p>There would be eight blocks.</p>
<p>One block covers the first dimension, but it takes 8 blocks to cover the second dimension (<span class="math inline">\(8 \times 8 = 64\)</span>). Also demonstrated by the code below:</p>
<div class="quarto-embed-nb-cell">
<div id="91647d07" class="cell" data-tags="[&quot;eight-blocks&quot;]" data-execution_count="13">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">// remove the old data</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">remove</span><span class="op">(</span>groupPath<span class="op">);</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">// rewrite with a different block size</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> blockSize <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[]{</span><span class="dv">64</span><span class="op">,</span><span class="dv">8</span><span class="op">};</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>N5Utils<span class="op">.</span><span class="fu">save</span><span class="op">(</span>img<span class="op">,</span> n5Writer<span class="op">,</span> groupPath<span class="op">,</span> blockSize<span class="op">,</span> compression<span class="op">);</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">// how many blocks are there?</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="fu">printBlocks</span><span class="op">(</span><span class="st">"my-container.n5/data"</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>my-container.n5/data/0/1 is 837 bytes
my-container.n5/data/0/7 is 847 bytes
my-container.n5/data/0/3 is 839 bytes
my-container.n5/data/0/6 is 844 bytes
my-container.n5/data/0/0 is 968 bytes
my-container.n5/data/0/4 is 846 bytes
my-container.n5/data/0/2 is 840 bytes
my-container.n5/data/0/5 is 847 bytes</code></pre>
</div>
</div>
</div>
</details>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try it!
</div>
</div>
<div class="callout-body-container callout-body">
<p>N5 lets you store your image in a single file if you want - just provide a block size that is equal to or larger than the image size.</p>
</div>
</div>
</section>
<section id="compression" class="level4">
<h4 class="anchored" data-anchor-id="compression"><code>compression</code></h4>
<p>Each block is compressed independently, using the specified compressor. Use <a href="https://github.com/saalfeldlab/n5/blob/6d6a353060a1edb05c8da7ded96ec93c4b14a1c4/src/main/java/org/janelia/saalfeldlab/n5/RawCompression.java"><code>RawCompression</code></a> to store blocks without compression.</p>
<div class="quarto-embed-nb-cell">
<div id="9b37d386" class="cell" data-tags="[&quot;no-compression&quot;]" data-execution_count="14">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">// rewrite without compression</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> groupPath <span class="op">=</span> <span class="st">"dataNoCompression"</span><span class="op">;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> blockSize <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[]{</span><span class="dv">32</span><span class="op">,</span><span class="dv">32</span><span class="op">};</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> compression <span class="op">=</span> <span class="kw">new</span> <span class="fu">RawCompression</span><span class="op">();</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>N5Utils<span class="op">.</span><span class="fu">save</span><span class="op">(</span>img<span class="op">,</span> n5Writer<span class="op">,</span> groupPath<span class="op">,</span> blockSize<span class="op">,</span> compression<span class="op">);</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co">// what size are the blocks</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="fu">printBlocks</span><span class="op">(</span><span class="st">"my-container.n5/dataNoCompression"</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>my-container.n5/dataNoCompression/1/1 is 4108 bytes
my-container.n5/dataNoCompression/1/0 is 4108 bytes
my-container.n5/dataNoCompression/0/1 is 4108 bytes
my-container.n5/dataNoCompression/0/0 is 4108 bytes</code></pre>
</div>
</div>
</div>
<p>Notice that blocks were previously ~1700-2000 bytes and are now ~4100 without compression.</p>
<p>The available compressors at the time of this writing are:</p>
<ul>
<li><a href="https://github.com/saalfeldlab/n5-blosc/blob/b4abb12cff739281fb703fd54975d6df654b021d/src/main/java/org/janelia/saalfeldlab/n5/blosc/BloscCompression.java"><code>BloscCompression</code></a></li>
<li><a href="https://github.com/saalfeldlab/n5/blob/6d6a353060a1edb05c8da7ded96ec93c4b14a1c4/src/main/java/org/janelia/saalfeldlab/n5/Bzip2Compression.java"><code>Bzip2Compression</code></a></li>
<li><a href="https://github.com/saalfeldlab/n5/blob/6d6a353060a1edb05c8da7ded96ec93c4b14a1c4/src/main/java/org/janelia/saalfeldlab/n5/GzipCompression.java"><code>GzipCompression</code></a></li>
<li><a href="https://github.com/saalfeldlab/n5/blob/6d6a353060a1edb05c8da7ded96ec93c4b14a1c4/src/main/java/org/janelia/saalfeldlab/n5/Lz4Compression.java"><code>Lz4Compression</code></a></li>
<li><a href="https://github.com/saalfeldlab/n5/blob/6d6a353060a1edb05c8da7ded96ec93c4b14a1c4/src/main/java/org/janelia/saalfeldlab/n5/RawCompression.java"><code>RawCompression</code></a></li>
<li><a href="https://github.com/saalfeldlab/n5/blob/6d6a353060a1edb05c8da7ded96ec93c4b14a1c4/src/main/java/org/janelia/saalfeldlab/n5/XzCompression.java"><code>XzCompression</code></a></li>
<li><a href="https://github.com/JaneliaSciComp/n5-zstandard/blob/1af7a5b56a60c0bb346f5795d936453557e1a947/src/main/java/org/janelia/scicomp/n5/zstandard/ZstandardCompression.java"><code>ZstandardCompression</code></a></li>
</ul>
</section>
</section>
</section>
<section id="metadata" class="level2">
<h2 class="anchored" data-anchor-id="metadata">Metadata</h2>
<p>Besides array data, N5 can also store rich structured metadata. This tutorial will discuss basic, low-level metadata operations. Advanced operations and metadata standards may be described in a future tutorial.</p>
<section id="basics" class="level3">
<h3 class="anchored" data-anchor-id="basics">Basics</h3>
<p><code>N5Writer</code>s have a <a href="https://github.com/saalfeldlab/n5/blob/6d6a353060a1edb05c8da7ded96ec93c4b14a1c4/src/main/java/org/janelia/saalfeldlab/n5/N5Writer.java#L55"><code>setAttribute</code></a> method for writing metadata to the storage backend. It takes three arguments:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="dt">void</span> <span class="fu">setAttribute</span><span class="op">(</span><span class="bu">String</span> groupPath<span class="op">,</span> <span class="bu">String</span> attributePath<span class="op">,</span> T attribute<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<ul>
<li><code>groupPath</code> : the group in which to store this metadata</li>
<li><code>attributePath</code> : the name of this attribute</li>
<li><code>attribute</code> : the metadata attribute to be stored. Can be an arbitrary type (denoted <code>T</code>).</li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There are differences between an attribute “name” and an attribute “path”, but attribute “paths” are an advanced topic and will be covered elsewhere.</p>
</div>
</div>
<p>Similarly, <code>N5Reader</code>s have a <a href="https://github.com/saalfeldlab/n5/blob/6d6a353060a1edb05c8da7ded96ec93c4b14a1c4/src/main/java/org/janelia/saalfeldlab/n5/N5Reader.java#L241-L244"><code>getAttribute</code></a> method:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="op">&lt;</span>T<span class="op">&gt;</span> T <span class="fu">getAttribute</span><span class="op">(</span><span class="bu">String</span> groupPath<span class="op">,</span> <span class="bu">String</span> attributePath<span class="op">,</span> <span class="bu">Class</span><span class="op">&lt;</span>T<span class="op">&gt;</span> clazz<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The last argument (<code>Class&lt;T&gt;</code>) lets you specify the type that <code>getAttribute</code> should return. An <code>N5Exception</code> will be thrown if the requested type can not be created from the requested attribute. If an attribute does not exist, <code>null</code> will be returned (see the last example of this section). Consider these examples:</p>
<div class="quarto-embed-nb-cell">
<div id="75f3c15f" class="cell" data-tags="[&quot;attributes-1&quot;]" data-execution_count="28">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// create a group inside the container (think: "folder")</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> groupName <span class="op">=</span> <span class="st">"put-data-in-me"</span><span class="op">;</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">createGroup</span><span class="op">(</span>groupName<span class="op">);</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">// attributes have names and values</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a><span class="co">// make an attribute called "date" with a String value</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> attributeName <span class="op">=</span> <span class="st">"date"</span><span class="op">;</span></span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">setAttribute</span><span class="op">(</span>groupName<span class="op">,</span> attributeName<span class="op">,</span> <span class="st">"2024-Jan-01"</span><span class="op">);</span></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a><span class="co">// Ask the N5 API to make a double array from the data attribute</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a><span class="co">// it will try and fail, so an exception will be thrown</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="cf">try</span> <span class="op">{</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">var</span> nothing <span class="op">=</span> n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>groupName<span class="op">,</span> attributeName<span class="op">,</span> <span class="dt">double</span><span class="op">[].</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">catch</span><span class="op">(</span> N5Exception e <span class="op">)</span> <span class="op">{</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>    <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span><span class="st">"Error: could not get attribute as double[]"</span><span class="op">);</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a><span class="co">// get the value of the "date" attribute as a String</span></span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="bu">String</span> date <span class="op">=</span> n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>groupName<span class="op">,</span> attributeName<span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>date</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Error: could not get attribute as double[]</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>2024-Jan-01</code></pre>
</div>
</div>
</div>
<p>Sometimes it is possible to interpret a metadata as multiple different types:</p>
<div class="quarto-embed-nb-cell">
<div id="bc080bb5" class="cell" data-tags="[&quot;attr-types&quot;]" data-execution_count="18">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">setAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"a"</span><span class="op">,</span> <span class="dv">42</span><span class="op">);</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> num <span class="op">=</span> n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"a"</span><span class="op">,</span> <span class="dt">double</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// 42.0</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> str <span class="op">=</span> n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"a"</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// "42"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
</section>
<section id="rich-metadata" class="level3">
<h3 class="anchored" data-anchor-id="rich-metadata">Rich metadata</h3>
<p>It possible to save attributes of arbitrary types, enabling you to struture your metadata into classes that are easy to save and load directly. For example, if we define a metadata class <code>FunWithMetadata</code>:</p>
<div class="quarto-embed-nb-cell">
<div id="76639ba3" class="cell" data-tags="[&quot;fun-with-metadata&quot;]" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> FunWithMetadata <span class="op">{</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">String</span> name<span class="op">;</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> number<span class="op">;</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span><span class="op">[]</span> data<span class="op">;</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">FunWithMetadata</span><span class="op">(</span><span class="bu">String</span> name<span class="op">,</span> <span class="dt">int</span> number<span class="op">,</span> <span class="dt">double</span><span class="op">[]</span> data<span class="op">)</span> <span class="op">{</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">name</span> <span class="op">=</span> name<span class="op">;</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">number</span> <span class="op">=</span> number<span class="op">;</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>        <span class="kw">this</span><span class="op">.</span><span class="fu">data</span> <span class="op">=</span> data<span class="op">;</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">String</span> <span class="fu">toString</span><span class="op">(){</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="bu">String</span><span class="op">.</span><span class="fu">format</span><span class="op">(</span> <span class="st">"FunWithMetadata{</span><span class="sc">%s</span><span class="st">(</span><span class="sc">%d</span><span class="st">): </span><span class="sc">%s</span><span class="st">}"</span><span class="op">,</span> </span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>            name<span class="op">,</span> number<span class="op">,</span> <span class="bu">Arrays</span><span class="op">.</span><span class="fu">toString</span><span class="op">(</span>data<span class="op">));</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<p>then make an instance and save it:</p>
<div class="quarto-embed-nb-cell">
<div id="03dc0d4d" class="cell" data-tags="[&quot;rich-metadata&quot;]" data-execution_count="20">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> metadata <span class="op">=</span> <span class="kw">new</span> <span class="fu">FunWithMetadata</span><span class="op">(</span><span class="st">"Dorothy"</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="kw">new</span> <span class="dt">double</span><span class="op">[]{</span><span class="fl">2.72</span><span class="op">,</span> <span class="fl">3.14</span><span class="op">});</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">setAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"metadata"</span><span class="op">,</span> metadata<span class="op">);</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> loadedMetadata <span class="op">=</span> n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"metadata"</span><span class="op">,</span> </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    FunWithMetadata<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>loadedMetadata</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">
<pre><code>FunWithMetadata{Dorothy(2): [2.72, 3.14]}</code></pre>
</div>
</div>
</div>
<p>To retrieve all the metadata in a group as JSON:</p>
<div class="quarto-embed-nb-cell">
<div id="1b8133bc" class="cell" data-tags="[&quot;all-metadata&quot;]" data-execution_count="21">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"/"</span><span class="op">,</span> JsonElement<span class="op">.</span><span class="fu">class</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>{"date":"2024-Jan-01","a":42,"metadata":{"name":"Dorothy","number":2,"data":[2.72,3.14]}}</code></pre>
</div>
</div>
</div>
</section>
<section id="removing-metadata" class="level3">
<h3 class="anchored" data-anchor-id="removing-metadata">Removing metadata</h3>
<p>You can remove attributes by their name as well. To return the element that was removed, just provide the class for that element (this mirrors the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/List.html#remove-int-">remove method</a> for <code>List</code>s in Java.</p>
<div class="quarto-embed-nb-cell">
<div id="5ebc9d0d" class="cell" data-tags="[&quot;remove-attrs&quot;]" data-execution_count="22">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co">// set attributes</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">setAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"sender"</span><span class="op">,</span> <span class="st">"Alice"</span><span class="op">);</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">setAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"receiver"</span><span class="op">,</span> <span class="st">"Bob"</span><span class="op">);</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co">// notice that they're set</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"sender"</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span>   <span class="co">// Alice</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"receiver"</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// Bob</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="co">// remove "sender"</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">removeAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"sender"</span><span class="op">);</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a><span class="co">// remove "receiver" and store result in a variable</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a><span class="dt">var</span> receiver <span class="op">=</span> n5Writer<span class="op">.</span><span class="fu">removeAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"receiver"</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// Bob</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"sender"</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span>   <span class="co">// null</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span>groupName<span class="op">,</span> <span class="st">"receiver"</span><span class="op">,</span> <span class="bu">String</span><span class="op">.</span><span class="fu">class</span><span class="op">);</span> <span class="co">// null</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Try it!
</div>
</div>
<div class="callout-body-container callout-body">
<p>The attributes that describe arrays are also accessible using <code>getAttribute</code>, try running:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>n5Writer<span class="op">.</span><span class="fu">getAttribute</span><span class="op">(</span><span class="st">"data"</span><span class="op">,</span> <span class="st">"dimensions"</span><span class="op">,</span> <span class="dt">long</span><span class="op">[].</span><span class="fu">class</span><span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>The attributes that N5 uses to read arrays can be set with <code>setAttribute</code>, and modifying them could corrupt your data. <strong>Do not manually set these attributes unless you absolutely know what you’re doing!</strong></p>
<ul>
<li><code>dimensions</code></li>
<li><code>blockSize</code></li>
<li><code>dataType</code></li>
<li><code>compression</code></li>
</ul>
</div>
</div>
</section>
</section>
<section id="what-to-try-next" class="level2">
<h2 class="anchored" data-anchor-id="what-to-try-next">What to try next</h2>
<ul>
<li><a href="https://imglib.github.io/imglib2-blog/posts/2022-09-27-n5-imglib2.html">How to work with the N5 API and ImgLib2</a></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>